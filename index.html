<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MaCin√©math√®que</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<header>
  <div class="logo">Ma<span>Cin√©math√®que</span></div>
  <div class="stats">
    <div><strong id="stat-count">0</strong>Films</div>
    <div><strong id="stat-size">0 MB</strong>Stockage</div>
  </div>
</header>

<nav>
  <button class="tab active" onclick="switchTab('library', this)">üìΩ Biblioth√®que</button>
  <button class="tab" onclick="switchTab('upload', this)">‚¨Ü Ajouter</button>
</nav>

<div class="container">

  <!-- UPLOAD TAB -->
  <div id="tab-upload" class="tab-content">
    <div class="upload-zone" id="dropzone" onclick="document.getElementById('fileInput').click()">
      <span class="upload-icon">üé¨</span>
      <h2>D√©poser vos films ici</h2>
      <p>
        Glissez-d√©posez vos fichiers vid√©o ou cliquez pour s√©lectionner<br>
        Tous vos films sont synchronis√©s sur Supabase
      </p>
      <div class="formats">
        <span class="badge">MP4</span>
        <span class="badge">MKV</span>
        <span class="badge">AVI</span>
        <span class="badge">MOV</span>
        <span class="badge">WMV</span>
        <span class="badge">FLV</span>
        <span class="badge">WEBM</span>
        <span class="badge">M4V</span>
        <span class="badge">TS</span>
        <span class="badge">MPG</span>
      </div>
    </div>
    <input
      type="file"
      id="fileInput"
      multiple
      style="display:none"
      onchange="handleFiles(this.files)"
    >
  </div>

  <!-- LIBRARY TAB -->
  <div id="tab-library" class="tab-content active">
    <div class="grid-header">
      <h2>
        Mes Films
        <span class="film-count-label" id="film-count-label"></span>
      </h2>
      <div class="search-box">
        <span class="search-icon">üîç</span>
        <input type="text" placeholder="Rechercher..." oninput="filterMovies(this.value)">
      </div>
    </div>
    <div class="movie-grid" id="movieGrid"></div>
    <div id="emptyState" class="empty">
      <div class="big-icon">üéû</div>
      <h3>Votre collection est vide</h3>
      <p>
        Ajoutez vos films via l'onglet <strong class="accent">Ajouter</strong><br>
        Ils seront synchronis√©s automatiquement sur tous vos appareils.
      </p>
    </div>
  </div>

</div>

<!-- PLAYER MODAL -->
<div class="modal-overlay" id="playerModal">
  <div class="modal">
    <div class="modal-header">
      <h2 id="modalTitle">Titre du film</h2>
      <button class="modal-close" onclick="closeModal()">‚úï</button>
    </div>
    <div class="modal-body">

      <div class="player-container">
        <video id="mainPlayer" controls preload="metadata"></video>
      </div>

      <div class="file-meta">
        <div class="meta-item">
          <label>Fichier</label>
          <span id="meta-name">‚Äî</span>
        </div>
        <div class="meta-item">
          <label>Taille</label>
          <span id="meta-size">‚Äî</span>
        </div>
        <div class="meta-item">
          <label>Format</label>
          <span id="meta-format">‚Äî</span>
        </div>
      </div>

      <div class="convert-panel">
        <h3>üîÑ Convertir en MP4 ‚Äî FFmpeg</h3>
        <div class="convert-options">
          <select id="qualitySelect">
            <option value="high">Haute qualit√© (CRF 18)</option>
            <option value="medium" selected>Qualit√© moyenne (CRF 23)</option>
            <option value="low">L√©g√®re (CRF 28, plus rapide)</option>
          </select>
          <button class="btn btn-blue" id="convertBtn" onclick="convertCurrentMovie()">Convertir en MP4</button>
          <button class="btn btn-secondary" id="downloadBtn" onclick="downloadCurrentMovie()">‚¨á T√©l√©charger</button>
        </div>
        <div id="convertProgress" style="display:none">
          <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="progress-label">
            <span id="progressLabel">Traitement...</span>
            <span id="progressPct">0%</span>
          </div>
          <div class="convert-stats" id="convertStats">
            <div class="stat-box">
              <span class="stat-icon">‚è±</span>
              <div>
                <label>Temps √©coul√©</label>
                <strong id="stat-elapsed">0:00</strong>
              </div>
            </div>
            <div class="stat-box">
              <span class="stat-icon">‚è≥</span>
              <div>
                <label>Temps restant</label>
                <strong id="stat-remaining">‚Äî</strong>
              </div>
            </div>
            <div class="stat-box">
              <span class="stat-icon">‚ö°</span>
              <div>
                <label>Vitesse</label>
                <strong id="stat-speed">‚Äî x</strong>
              </div>
            </div>
            <div class="stat-box">
              <span class="stat-icon">üéû</span>
              <div>
                <label>FPS encodage</label>
                <strong id="stat-fps">‚Äî fps</strong>
              </div>
            </div>
            <div class="stat-box">
              <span class="stat-icon">üì¶</span>
              <div>
                <label>Taille g√©n√©r√©e</label>
                <strong id="stat-written">0 MB</strong>
              </div>
            </div>
          </div>
        </div>
        <div id="convertResult" style="display:none"></div>
      </div>

    </div>
  </div>
</div>

<!-- TOAST -->
<div class="toast-container" id="toastContainer"></div>

<script>
  // Enregistrement du Service Worker (requis pour FFmpeg.wasm / SharedArrayBuffer)
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').catch(console.warn);
  }
</script>
<script src="app.js" type="module"></script>
</body>
</html>
